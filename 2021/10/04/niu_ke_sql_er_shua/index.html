

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#3cbdfe">
  <meta name="description" content="二刷牛客80道SQL题">
  <meta name="author" content="CAIWEI">
  <meta name="keywords" content="">
  <meta name="description" content="二刷牛客80道SQL题">
<meta property="og:type" content="article">
<meta property="og:title" content="牛客SQL二刷">
<meta property="og:url" content="http://example.com/2021/10/04/niu_ke_sql_er_shua/index.html">
<meta property="og:site_name" content="CAIWEI的博客">
<meta property="og:description" content="二刷牛客80道SQL题">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-10-04T07:04:37.000Z">
<meta property="article:modified_time" content="2021-11-24T09:36:19.535Z">
<meta property="article:author" content="CAIWEI">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary_large_image">
  
  <title>牛客SQL二刷 - CAIWEI的博客</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="CAIWEI的博客" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong> </strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/0.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="牛客SQL二刷">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-10-04 15:04" pubdate>
        2021年10月4日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      16k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      51 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">牛客SQL二刷</h1>
            
            <div class="markdown-body">
              <p>二刷牛客80道SQL题</p>
<a id="more"></a>
<p><a href="https://www.nowcoder.com/activity/oj?tab=1" target="_blank" rel="noopener">牛客SQL题</a></p>
<h4 id="section">1</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees <br><span class="hljs-keyword">WHERE</span> hire_date == ( <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(hire_date) <span class="hljs-keyword">FROM</span> employees )<br></code></pre></div></td></tr></tbody></table></figure>
<p>或</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees <br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date <span class="hljs-keyword">DESC</span><br><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></div></td></tr></tbody></table></figure>
<p>错误写法：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> emp_no,<span class="hljs-keyword">MAX</span>(hire_date),first_name,last_name,gender,hire_date <span class="hljs-keyword">FROM</span> employees<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-1">2</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees <br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date <span class="hljs-keyword">DESC</span><br><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">2</span>,<span class="hljs-number">1</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-2">3</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.emp_no,t1.salary,t1.from_date,t1.to_date,t2.dept_no <br><span class="hljs-keyword">FROM</span> salaries t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_manager t2<br><span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">WHERE</span> t2.dept_no <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t1.emp_no<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-3">4</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.last_name,t1.first_name,t2.dept_no <br><span class="hljs-keyword">FROM</span> employees t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp t2<br><span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">WHERE</span> t2.dept_no <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-4">5</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.last_name,t1.first_name,t2.dept_no <br><span class="hljs-keyword">FROM</span> employees t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp t2<br><span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-5">7</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> emp_no,<span class="hljs-keyword">COUNT</span>(emp_no) <span class="hljs-keyword">AS</span> t <span class="hljs-keyword">FROM</span> salaries<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp_no<br><span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(emp_no) &gt; <span class="hljs-number">15</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-6">8</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> salary <span class="hljs-keyword">FROM</span> salaries<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-7">10</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> emp_no <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> dept_manager<br>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-8">11</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.emp_no,t2.emp_no <br><span class="hljs-keyword">FROM</span> dept_emp t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_manager t2<br><span class="hljs-keyword">ON</span> t1.dept_no = t2.dept_no <br><span class="hljs-keyword">WHERE</span> t1.emp_no &lt;&gt; t2.emp_no<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-9">12</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.dept_no,t1.emp_no,t2.salary<br><span class="hljs-keyword">FROM</span> dept_emp t1<br><span class="hljs-keyword">JOIN</span> salaries t2<br><span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">WHERE</span> (dept_no,salary) <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> dept_no,<span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">AS</span> salary <br>    <span class="hljs-keyword">FROM</span> dept_emp t1<br>    <span class="hljs-keyword">JOIN</span> salaries t2<br>    <span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> dept_no<br>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t1.dept_no<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-10">15</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> emp_no % <span class="hljs-number">2</span> == <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> last_name &lt;&gt; <span class="hljs-string">'Mary'</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date <span class="hljs-keyword">DESC</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-11">16</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.title,<span class="hljs-keyword">AVG</span>(t2.salary) <br><span class="hljs-keyword">FROM</span> titles t1<br><span class="hljs-keyword">JOIN</span> salaries t2<br><span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t1.title<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">AVG</span>(t2.salary)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-12">17</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> emp_no,salary <span class="hljs-keyword">FROM</span> salaries<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span><br><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-13">18</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t2.emp_no,t2.salary,t1.last_name,t1.first_name <br><span class="hljs-keyword">FROM</span> employees t1<br><span class="hljs-keyword">JOIN</span> salaries t2<br><span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">WHERE</span> salary <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">AS</span> salary <span class="hljs-keyword">FROM</span> salaries<br>    <span class="hljs-keyword">WHERE</span> salary &lt; (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">AS</span> salary <span class="hljs-keyword">FROM</span> salaries)<br>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-14">19</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name,first_name,dept_name <span class="hljs-keyword">FROM</span> employees t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp t2 <span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> departments t3 <span class="hljs-keyword">ON</span> t2.dept_no = t3.dept_no<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-15">21</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> emp_no,(EndSalary- StartSalary) <span class="hljs-keyword">AS</span> growth <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> t1.emp_no,t2.salary <span class="hljs-keyword">AS</span> EndSalary,t3.salary <span class="hljs-keyword">AS</span> StartSalary<br>    <span class="hljs-keyword">FROM</span> salaries t1<br>    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>        <span class="hljs-keyword">SELECT</span> emp_no,salary <span class="hljs-keyword">FROM</span> salaries<br>        <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span><br>    ) t2 <span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br>    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>        <span class="hljs-keyword">SELECT</span> salaries.emp_no,salary <span class="hljs-keyword">FROM</span> salaries<br>        <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> employees <span class="hljs-keyword">ON</span> salaries.emp_no = salaries.emp_no<br>        <span class="hljs-keyword">WHERE</span> from_date = hire_date<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> salaries.emp_no<br>    ) t3 <span class="hljs-keyword">ON</span> t2.emp_no = t3.emp_no<br>    <span class="hljs-keyword">WHERE</span> t1.emp_no <span class="hljs-keyword">IN</span> (<br>        <span class="hljs-comment">-- 查询在职员工编号</span><br>        <span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> salaries<br>        <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span><br>    )<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t1.emp_no<br>) t<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> (EndSalary- StartSalary)<br></code></pre></div></td></tr></tbody></table></figure>
<p>错误写法（这种没考虑到降薪的情况）：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> emp_no,(MaxSalary- MinSalary) <span class="hljs-keyword">AS</span> growth <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> emp_no,<span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">AS</span> MaxSalary,<span class="hljs-keyword">MIN</span>(salary)  <span class="hljs-keyword">AS</span> MinSalary<br>    <span class="hljs-keyword">FROM</span> salaries<br>    <span class="hljs-keyword">WHERE</span> emp_no <span class="hljs-keyword">IN</span> (<br>        <span class="hljs-comment">-- 查询在职员工编号</span><br>        <span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> salaries<br>        <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span>=<span class="hljs-string">'9999-01-01'</span><br>    )<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp_no<br>) t<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> (MaxSalary- MinSalary)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-16">22</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t3.dept_no,t3.dept_name,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">FROM</span> salaries t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp t2 <span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> departments t3 <span class="hljs-keyword">ON</span> t2.dept_no = t3.dept_no<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t3.dept_no<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t3.dept_no<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-17">23</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> emp_no,salary,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">FROM</span> salaries<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-18">24</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t3.dept_no,t1.emp_no,t2.salary <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees<br>    <span class="hljs-keyword">WHERE</span> emp_no <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<br>        <span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> dept_manager<br>    )<br>) t1 <br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>    <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> salaries<br>) t2 <span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no <br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>    <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> dept_emp<br>) t3 <span class="hljs-keyword">ON</span> t2.emp_no = t3.emp_no<br><span class="hljs-keyword">WHERE</span> t3.dept_no <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-19">25</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.emp_no,t4.emp_no,t1.salary,t4.salary<br><span class="hljs-keyword">FROM</span> salaries t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp t2 <span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_manager t3 <span class="hljs-keyword">ON</span> t2.dept_no = t3.dept_no<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> salaries t4 <span class="hljs-keyword">ON</span> t3.emp_no = t4.emp_no<br><span class="hljs-keyword">WHERE</span> t1.salary &gt; t4.salary<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-20">26</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.dept_no,t3.dept_name,t2.title,<span class="hljs-keyword">COUNT</span>(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">FROM</span> dept_emp t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> titles t2 <span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> departments t3 <span class="hljs-keyword">ON</span> t1.dept_no = t3.dept_no<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t1.dept_no,t3.dept_name,t2.title<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t1.dept_no<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-21">28</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t3.name,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">FROM</span> film t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> film_category t2 <span class="hljs-keyword">ON</span> t1.film_id = t2.film_id<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">category</span> t3 <span class="hljs-keyword">ON</span> t2.category_id = t3.category_id<br><span class="hljs-keyword">WHERE</span> t1.description <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%robot%'</span> <span class="hljs-keyword">AND</span> t2.category_id <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> category_id <span class="hljs-keyword">FROM</span> film_category<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> category_id<br>    <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt;= <span class="hljs-number">5</span><br>)<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t3.name<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-22">29</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.film_id,t1.title <span class="hljs-keyword">FROM</span> film t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> film_category t2 <span class="hljs-keyword">ON</span> t1.film_id = t2.film_id<br><span class="hljs-keyword">WHERE</span> t2.category_id <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-23">30</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.title,t1.description <span class="hljs-keyword">FROM</span> film t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> film_category t2 <span class="hljs-keyword">ON</span> t1.film_id = t2.film_id<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">category</span> t3 <span class="hljs-keyword">ON</span> t2.category_id = t3.category_id<br><span class="hljs-keyword">WHERE</span> t3.name = <span class="hljs-string">'Action'</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-24">32</h4>
<ul>
<li>sqlite</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> last_name||<span class="hljs-string">' '</span>||first_name <span class="hljs-keyword">AS</span> <span class="hljs-keyword">Name</span> <span class="hljs-keyword">FROM</span> employees<br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>MySQL</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CONCAT</span>(last_name,<span class="hljs-string">' '</span>,first_name) <span class="hljs-keyword">FROM</span> employees<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-25">33</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor(<br>    actor_id <span class="hljs-built_in">smallint</span>(<span class="hljs-number">5</span>) PRIMARY <span class="hljs-keyword">KEY</span>,<br>    first_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<br>    last_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<br>    last_update <span class="hljs-built_in">date</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span><br>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-26">34</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> actor<br><span class="hljs-keyword">VALUES</span>(<span class="hljs-number">1</span>,<span class="hljs-string">'PENELOPE'</span>,<span class="hljs-string">'GUINESS'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>),<br>      (<span class="hljs-number">2</span>,<span class="hljs-string">'NICK'</span>,<span class="hljs-string">'WAHLBERG'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-27">35</h4>
<ul>
<li>MySQL</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">IGNORE</span> <span class="hljs-keyword">INTO</span> actor <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'3'</span>,<span class="hljs-string">'ED'</span>,<span class="hljs-string">'CHASE'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>)<br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>sqlite</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">IGNORE</span> <span class="hljs-keyword">INTO</span> actor <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'3'</span>,<span class="hljs-string">'ED'</span>,<span class="hljs-string">'CHASE'</span>,<span class="hljs-string">'2006-02-15 12:34:33'</span>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-28">36</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> actor_name(<br>    first_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,<br>    last_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span><br>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> actor_name<br><span class="hljs-keyword">SELECT</span> first_name,last_name <span class="hljs-keyword">FROM</span> actor<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-29">37</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> actor <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> uniq_idx_firstname(first_name);<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> actor <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> idx_lastname(last_name);<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-30">38</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> actor_name_view <span class="hljs-keyword">AS</span> <br><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">AS</span> first_name_v,last_name <span class="hljs-keyword">AS</span> last_name_v <span class="hljs-keyword">FROM</span> actor<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-31">39</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> salaries <span class="hljs-keyword">FORCE</span> <span class="hljs-keyword">INDEX</span> (idx_emp_no) <span class="hljs-keyword">WHERE</span> emp_no = <span class="hljs-number">10005</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-32">40</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> actor <span class="hljs-keyword">ADD</span> create_date datetime <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'2020-10-01 00:00:00'</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-33">41</h4>
<p>（这个不是我写的）</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> audit_log<br><span class="hljs-keyword">after</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">on</span> employees_test<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">row</span><br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">audit</span> <span class="hljs-keyword">values</span>(new.id,new.name);<br><span class="hljs-keyword">end</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-34">42</h4>
<ul>
<li>MySQL</li>
</ul>
<p><strong>MySQL中不允许在子查询的同时删除表数据（不能一边查一边把查的表删了）</strong>，所以可以把得出的表重命名（因为那样就不是原表了）</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> titles_test<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">FROM</span> (<br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(<span class="hljs-keyword">id</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">id</span>,emp_no <span class="hljs-keyword">FROM</span> titles_test<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> emp_no<br>    ) t<br>)<br></code></pre></div></td></tr></tbody></table></figure>
<p>sqlite也能这样写</p>
<h4 id="section-35">43</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> titles_test <span class="hljs-keyword">SET</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-literal">null</span>,from_date =  <span class="hljs-string">'2001-01-01'</span> <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-36">44</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> titles_test <span class="hljs-keyword">SET</span> emp_no = <span class="hljs-keyword">REPLACE</span>(emp_no,<span class="hljs-number">10001</span>,<span class="hljs-number">10005</span>) <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span> = <span class="hljs-number">5</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-37">45</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> titles_test <span class="hljs-keyword">RENAME</span> <span class="hljs-keyword">TO</span> titles_2017<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-38">46</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">audit</span><br><span class="hljs-keyword">ADD</span> <span class="hljs-keyword">CONSTRAINT</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">KEY</span> (emp_no)<br><span class="hljs-keyword">REFERENCES</span> employees_test(<span class="hljs-keyword">id</span>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-39">48</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> salaries <span class="hljs-keyword">JOIN</span> emp_bonus <span class="hljs-keyword">ON</span> emp_bonus.emp_no = salaries.emp_no<br><span class="hljs-keyword">SET</span> salary=salary*<span class="hljs-number">1.1</span><br><span class="hljs-keyword">WHERE</span> salaries.to_date=<span class="hljs-string">'9999-01-01'</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-40">50</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CONCAT</span>(last_name,<span class="hljs-string">"'"</span>,first_name) <span class="hljs-keyword">FROM</span> employees<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-41">51</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LENGTH</span>(<span class="hljs-string">"10,A,B"</span>) - <span class="hljs-keyword">LENGTH</span>(<span class="hljs-keyword">REPLACE</span>(<span class="hljs-string">"10,A,B"</span>,<span class="hljs-string">','</span>,<span class="hljs-string">''</span>))<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-42">52</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">SUBSTR</span>(first_name,<span class="hljs-number">-2</span>,<span class="hljs-number">2</span>) 	<span class="hljs-comment">--从倒数第二开始，获取两个字符</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-43">53</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> dept_no,<span class="hljs-keyword">GROUP_CONCAT</span>(emp_no SEPARATOR <span class="hljs-string">','</span>) <span class="hljs-keyword">FROM</span> dept_emp<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> dept_no<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-44">54</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">AVG</span>(salary) <span class="hljs-keyword">FROM</span> salaries<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span> <span class="hljs-keyword">AND</span> <br>salary <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MAX</span>(salary) <span class="hljs-keyword">AS</span> salary <span class="hljs-keyword">FROM</span> salaries<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span><br>    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span><br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">MIN</span>(salary) <span class="hljs-keyword">AS</span> salary <span class="hljs-keyword">FROM</span> salaries<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span><br>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-45">55</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">5</span>,<span class="hljs-number">5</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-46">57</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<br>    <span class="hljs-keyword">SELECT</span> emp_no <span class="hljs-keyword">FROM</span> dept_emp <span class="hljs-keyword">WHERE</span> dept_emp.emp_no = employees.emp_no<br>)<br></code></pre></div></td></tr></tbody></table></figure>
<p>也可以写成</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> emp_no = (<br>    <span class="hljs-keyword">SELECT</span> employees.emp_no <span class="hljs-keyword">FROM</span> employees <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> dept_emp<br>    <span class="hljs-keyword">ON</span> dept_emp.emp_no = employees.emp_no<br>    <span class="hljs-keyword">WHERE</span> dept_emp.emp_no <span class="hljs-keyword">is</span> <span class="hljs-literal">null</span><br>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-47">59</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.emp_no,first_name,last_name,btype,salary,<br>    <span class="hljs-keyword">IF</span>(btype=<span class="hljs-number">1</span>,salary*<span class="hljs-number">0.1</span>,<span class="hljs-keyword">IF</span>(btype=<span class="hljs-number">2</span>,salary*<span class="hljs-number">0.2</span>,salary*<span class="hljs-number">0.3</span>)) <span class="hljs-keyword">AS</span> bonu<br><span class="hljs-keyword">FROM</span> employees t1<br><span class="hljs-keyword">JOIN</span> emp_bonus t2 <span class="hljs-keyword">ON</span> t1.emp_no = t2.emp_no<br><span class="hljs-keyword">JOIN</span> salaries t3 <span class="hljs-keyword">ON</span> t1.emp_no = t3.emp_no<br><span class="hljs-keyword">WHERE</span> t3.to_date = <span class="hljs-string">'9999-01-01'</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-48">60</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> emp_no,salary,<span class="hljs-keyword">SUM</span>(salary) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> emp_no) <span class="hljs-keyword">FROM</span> salaries<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">to_date</span> = <span class="hljs-string">'9999-01-01'</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-49">61</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> employees<br><span class="hljs-keyword">WHERE</span> first_name <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> first_name <span class="hljs-keyword">FROM</span> (<br>        <span class="hljs-keyword">SELECT</span> first_name,ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_name) <span class="hljs-keyword">AS</span> rn <span class="hljs-keyword">FROM</span> employees<br>    ) t <br>    <span class="hljs-keyword">WHERE</span> rn%<span class="hljs-number">2</span> = <span class="hljs-number">1</span><br>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-50">62</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">FROM</span> grade<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">number</span><br><span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt;= <span class="hljs-number">3</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-51">63</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,<span class="hljs-built_in">number</span>,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">number</span> <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">FROM</span> passing_number<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-52">64</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> person.id,person.name,task.content <span class="hljs-keyword">FROM</span> person<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task <span class="hljs-keyword">ON</span> task.person_id = person.id<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-53">65</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">type</span>)/<span class="hljs-keyword">COUNT</span>(*),<span class="hljs-number">3</span>) <span class="hljs-keyword">AS</span> p <br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">IF</span>(<span class="hljs-keyword">type</span>=<span class="hljs-string">'no_completed'</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">type</span><br>    <span class="hljs-keyword">FROM</span> email<br>    <span class="hljs-keyword">WHERE</span> send_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span><br>        <span class="hljs-keyword">WHERE</span> is_blacklist = <span class="hljs-number">1</span><br>    )<br>    <span class="hljs-keyword">AND</span> receive_id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span><br>        <span class="hljs-keyword">WHERE</span> is_blacklist = <span class="hljs-number">1</span><br>    )<br>) t<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-54">66</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MAX</span>(<span class="hljs-built_in">date</span>) <span class="hljs-keyword">FROM</span> login<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-55">67</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t2.name,t3.name,<span class="hljs-built_in">date</span> <span class="hljs-keyword">FROM</span> login t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> t2 <span class="hljs-keyword">ON</span> t1.user_id = t2.id<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">client</span> t3 <span class="hljs-keyword">ON</span> t1.client_id = t3.id<br><span class="hljs-keyword">WHERE</span> (user_id,<span class="hljs-built_in">date</span>) <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MAX</span>(<span class="hljs-built_in">date</span>) <span class="hljs-keyword">FROM</span> login<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t2.name<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-56">68</h4>
<ul>
<li>新写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">SUM</span>(tag)/<span class="hljs-keyword">COUNT</span>(*),<span class="hljs-number">3</span>) <br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> t1.user_id,<span class="hljs-keyword">IF</span>(<span class="hljs-keyword">MIN</span>(t2.date) <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>) <span class="hljs-keyword">AS</span> tag <span class="hljs-keyword">FROM</span> login t1<br>    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> login t2<br>    <span class="hljs-keyword">ON</span> t1.user_id = t2.user_id <span class="hljs-keyword">AND</span> t1.date = (t2.date - <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t1.user_id<br>) t<br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) / (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-keyword">FROM</span> login),<span class="hljs-number">3</span>)<br><span class="hljs-keyword">FROM</span> login<br><span class="hljs-keyword">WHERE</span> (user_id,<span class="hljs-built_in">date</span>) <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">DATE_ADD</span>(<span class="hljs-keyword">MIN</span>(<span class="hljs-built_in">date</span>),<span class="hljs-built_in">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">DAY</span>) <span class="hljs-keyword">FROM</span> login <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>)<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-57">69</h4>
<ul>
<li>新写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> t1.date,<span class="hljs-keyword">IF</span>(cnt <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>,<span class="hljs-number">0</span>,cnt) <span class="hljs-keyword">FROM</span> login t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> cnt <br>    <span class="hljs-keyword">FROM</span> (<br>        <span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MIN</span>(<span class="hljs-built_in">date</span>) <span class="hljs-keyword">AS</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">FROM</span> login<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>    ) t0<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span><br>) t2<br><span class="hljs-keyword">ON</span> t1.date = t2.date<br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment"># SELECT date,COUNT(*) FROM login</span><br><span class="hljs-comment"># WHERE (user_id,date) IN (</span><br><span class="hljs-comment">#     SELECT user_id,MIN(date) FROM login GROUP BY user_id</span><br><span class="hljs-comment"># )</span><br><span class="hljs-comment"># GROUP BY date</span><br><br><span class="hljs-comment">## 计数为 0 的日期没有现实(新写法基于这种写法改了下)</span><br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">SUM</span>(<br>    <span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> (user_id,<span class="hljs-built_in">date</span>) <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MIN</span>(<span class="hljs-built_in">date</span>) <span class="hljs-keyword">FROM</span> login <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>    ) <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <br>    <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">END</span><br>)<br><span class="hljs-keyword">FROM</span> login<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-58">70</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> t5.date,<span class="hljs-keyword">IF</span>(p <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>,<span class="hljs-number">0</span>,p) <span class="hljs-keyword">FROM</span> login t5<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>    <span class="hljs-keyword">SELECT</span> t3.date,<span class="hljs-keyword">ROUND</span>(t4.num/t3.num,<span class="hljs-number">3</span>) <span class="hljs-keyword">AS</span> p <br>    <span class="hljs-keyword">FROM</span> (<br>        <span class="hljs-comment">-- 计算当天新用户数</span><br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">FROM</span> (<br>            <span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MIN</span>(<span class="hljs-built_in">date</span>) <span class="hljs-keyword">AS</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">FROM</span> login<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>        ) t1<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span><br>    ) t3<br>    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>        <span class="hljs-comment">-- 计算新用户次日留存数</span><br>        <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">DATE</span>(t2.date<span class="hljs-number">-1</span>) <span class="hljs-keyword">AS</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">FROM</span> login t1<br>        <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>            <span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MIN</span>(<span class="hljs-built_in">date</span>)+<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">FROM</span> login<br>            <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>        ) t2 <span class="hljs-keyword">ON</span> t1.user_id = t2.user_id <span class="hljs-keyword">AND</span> t1.date = t2.date<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t2.date <br>    ) t4<br>    <span class="hljs-keyword">ON</span> t3.date = t4.date<br>) t6 <span class="hljs-keyword">ON</span> t5.date = t6.date<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-59">71</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t2.name,t1.date,<span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span>) <br><span class="hljs-keyword">FROM</span> passing_number t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span> t2 <span class="hljs-keyword">ON</span> t1.user_id = t2.id<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span>,<span class="hljs-keyword">name</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-60">72</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">ROUND</span>(<span class="hljs-keyword">AVG</span>(score),<span class="hljs-number">3</span>) <span class="hljs-keyword">AS</span> AvgScore <span class="hljs-keyword">FROM</span> grade<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> AvgScore <span class="hljs-keyword">DESC</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-61">73</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.id,t1.job,t1.score <span class="hljs-keyword">FROM</span> grade t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>    <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">AVG</span>(score) <span class="hljs-keyword">AS</span> score <span class="hljs-keyword">FROM</span> grade<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<br>) t2<br><span class="hljs-keyword">ON</span> t1.job = t2.job<br><span class="hljs-keyword">WHERE</span> t1.score &gt; t2.score<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t1.id<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-62">74</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span>,score <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> t1.id,<span class="hljs-keyword">name</span>,score,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> language_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rn<br>    <span class="hljs-keyword">FROM</span> grade t1<br>    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-string">`language`</span> t2<br>    <span class="hljs-keyword">ON</span> t1.language_id = t2.id<br>) t<br><span class="hljs-keyword">WHERE</span> rn &lt;=<span class="hljs-number">2</span> <br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">name</span>,score <span class="hljs-keyword">DESC</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-63">75</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br>    job,<br>    <span class="hljs-keyword">IF</span>(cnt%<span class="hljs-number">2</span>=<span class="hljs-number">1</span>,<span class="hljs-keyword">CEILING</span>(cnt/<span class="hljs-number">2</span>),<span class="hljs-keyword">ROUND</span>(cnt/<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)) <span class="hljs-keyword">AS</span> <span class="hljs-string">`start`</span>,<br>    <span class="hljs-keyword">IF</span>(cnt%<span class="hljs-number">2</span>=<span class="hljs-number">1</span>,<span class="hljs-keyword">CEILING</span>(cnt/<span class="hljs-number">2</span>),<span class="hljs-keyword">ROUND</span>(cnt/<span class="hljs-number">2</span>+<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)) <span class="hljs-keyword">AS</span> <span class="hljs-string">`end`</span><br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> cnt <span class="hljs-keyword">FROM</span> grade<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<br>) t<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> job<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-64">76</h4>
<ul>
<li>新的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,job,score,rn2 <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> <br>        t1.job,<br>        t1.id,<br>        t1.score,<br>        t2.cnt,<br>        ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> job <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score) <span class="hljs-keyword">AS</span> rn1,<br>        ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> job <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rn2<br>    <span class="hljs-keyword">FROM</span> grade t1<br>    <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>        <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> cnt <span class="hljs-keyword">FROM</span> grade<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<br>    ) t2<br>    <span class="hljs-keyword">ON</span> t1.job = t2.job<br>) t<br><span class="hljs-keyword">WHERE</span> rn1 &gt;= cnt/<span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> rn2 &gt;= cnt/<span class="hljs-number">2</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span><br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,job,score,t_rank <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,job,score,ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> job <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> score <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> t_rank<br>    <span class="hljs-keyword">FROM</span> grade<br>) c<br><span class="hljs-keyword">WHERE</span> (job,t_rank) <span class="hljs-keyword">IN</span> (<br><br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> job,<span class="hljs-keyword">ROUND</span>(t_rank,<span class="hljs-number">0</span>) <span class="hljs-keyword">FROM</span> (<br><br>    <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">IF</span>(<span class="hljs-keyword">num</span>%<span class="hljs-number">2</span>=<span class="hljs-number">1</span>,<span class="hljs-keyword">CEILING</span>(<span class="hljs-keyword">num</span>/<span class="hljs-number">2</span>),<span class="hljs-literal">null</span>) <span class="hljs-keyword">AS</span> t_rank<br>    <span class="hljs-keyword">FROM</span> ( <br>        <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">FROM</span> grade<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<br>    ) a<br>    <span class="hljs-keyword">UNION</span><br>    <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">IF</span>(<span class="hljs-keyword">num</span>%<span class="hljs-number">2</span>=<span class="hljs-number">0</span>,<span class="hljs-keyword">num</span>/<span class="hljs-number">2</span>,<span class="hljs-literal">null</span>) <span class="hljs-keyword">AS</span> t_rank<br>    <span class="hljs-keyword">FROM</span> ( <br>        <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">FROM</span> grade<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<br>    ) a<br>    <span class="hljs-keyword">UNION</span><br>    <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">IF</span>(<span class="hljs-keyword">num</span>%<span class="hljs-number">2</span>=<span class="hljs-number">0</span>,<span class="hljs-keyword">num</span>/<span class="hljs-number">2</span>+<span class="hljs-number">1</span>,<span class="hljs-literal">null</span>) <span class="hljs-keyword">AS</span> t_rank<br>    <span class="hljs-keyword">FROM</span> ( <br>        <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">FROM</span> grade<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<br>        ) a<br><br>    ) b<br>    <span class="hljs-keyword">WHERE</span> t_rank &lt;&gt; <span class="hljs-string">'NULL'</span><br><br>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-65">77</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> order_info<br><span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br><span class="hljs-keyword">AND</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br><span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-66">78</h4>
<ul>
<li>新写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> user_id <span class="hljs-keyword">FROM</span> order_info<br><span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br><span class="hljs-keyword">AND</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br><span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br><span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt;= <span class="hljs-number">2</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id<br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> user_id <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">num</span> <span class="hljs-keyword">FROM</span> order_info<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>    <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>    <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>) a<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">num</span> &gt;=<span class="hljs-number">2</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id<br><br><span class="hljs-comment">-- #写法二：</span><br><span class="hljs-comment">-- SELECT DISTINCT user_id FROM order_info</span><br><span class="hljs-comment">-- WHERE user_id IN (</span><br><span class="hljs-comment">--     SELECT user_id FROM order_info</span><br><span class="hljs-comment">--     WHERE status = 'completed' </span><br><span class="hljs-comment">--     AND product_name IN ('C++','Java','Python')</span><br><span class="hljs-comment">--     AND date &gt; '2025-10-15'</span><br><span class="hljs-comment">--     GROUP BY user_id</span><br><span class="hljs-comment">--     HAVING COUNT(*) &gt;= 2</span><br><span class="hljs-comment">-- )</span><br><span class="hljs-comment">-- ORDER BY user_id</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-67">79</h4>
<ul>
<li>新的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,user_id,product_name,<span class="hljs-keyword">status</span>,client_id,<span class="hljs-built_in">date</span><br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> *,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> user_id) <span class="hljs-keyword">AS</span> cnt<br>    <span class="hljs-keyword">FROM</span> order_info<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>    <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>    <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br>) t<br><span class="hljs-keyword">WHERE</span> cnt &gt;=<span class="hljs-number">2</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span><br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> order_info<br><span class="hljs-keyword">WHERE</span> user_id <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> user_id <span class="hljs-keyword">FROM</span> order_info<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>    <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>    <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>    <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt;= <span class="hljs-number">2</span><br>    )<br><span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br><span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br><span class="hljs-keyword">AND</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-68">80</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">MIN</span>(<span class="hljs-built_in">date</span>),<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">FROM</span> order_info<br><span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br><span class="hljs-keyword">AND</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br><span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br><span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt;= <span class="hljs-number">2</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-69">81</h4>
<ul>
<li>新的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br>    user_id,<br>    <span class="hljs-built_in">DATE</span>(<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> rn <span class="hljs-keyword">WHEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">END</span>)),<br>    <span class="hljs-built_in">DATE</span>(<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">CASE</span> rn <span class="hljs-keyword">WHEN</span> <span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">END</span>)),<br>    <span class="hljs-keyword">COUNT</span>(*)<br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> <br>        user_id,<br>        <span class="hljs-built_in">date</span>,<br>        ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span>) <span class="hljs-keyword">AS</span> rn<br>    <span class="hljs-keyword">FROM</span> order_info<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br>    <span class="hljs-keyword">AND</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>    <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>) t<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br><span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt;=<span class="hljs-number">2</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id<br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> order_info.user_id,<span class="hljs-built_in">DATE</span>(<span class="hljs-keyword">MIN</span>(order_info.date)),b.date,<span class="hljs-keyword">COUNT</span>(*) <br><span class="hljs-keyword">FROM</span> order_info<br><span class="hljs-keyword">JOIN</span> (<br>    <span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-built_in">date</span> <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">id</span>,user_id,<span class="hljs-built_in">date</span>,ROW_NUMBER() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-built_in">date</span>) <span class="hljs-keyword">AS</span> rs <span class="hljs-keyword">FROM</span> order_info<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>    <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>    <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br>    ) a<br>    <span class="hljs-keyword">WHERE</span> rs = <span class="hljs-number">2</span><br>    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user_id<br>) b <br><span class="hljs-keyword">ON</span> order_info.user_id = b.user_id<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br><span class="hljs-keyword">AND</span> order_info.product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br><span class="hljs-keyword">AND</span> order_info.date &gt; <span class="hljs-string">'2025-10-15'</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> order_info.user_id<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> order_info.user_id<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-70">82</h4>
<ul>
<li>新的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br>    t1.id,<br>    is_group_buy,<br>    <span class="hljs-keyword">IF</span>(is_group_buy = <span class="hljs-string">'NO'</span>,t2.name,<span class="hljs-literal">NULL</span>)<br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> *,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> user_id) <span class="hljs-keyword">AS</span> cnt<br>    <span class="hljs-keyword">FROM</span> order_info<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>    <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>    <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br>) t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>    <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">client</span><br>) t2<br><span class="hljs-keyword">ON</span> t1.client_id = t2.id<br><span class="hljs-keyword">WHERE</span> cnt &gt;=<span class="hljs-number">2</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span><br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> order_info.id,order_info.is_group_buy,client.name <br><span class="hljs-keyword">FROM</span> order_info<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">client</span> <br><span class="hljs-keyword">ON</span> order_info.client_id = client.id<br><span class="hljs-keyword">WHERE</span> user_id <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> user_id <span class="hljs-keyword">FROM</span> order_info<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>    <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>    <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-12'</span><br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>    <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt;=<span class="hljs-number">2</span><br>)<br><span class="hljs-keyword">AND</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br><span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br><span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-12'</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> order_info.id<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-71">83</h4>
<ul>
<li>新的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <br>    <span class="hljs-keyword">IF</span>(<span class="hljs-keyword">name</span> <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">'GroupBuy'</span>,<span class="hljs-keyword">name</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">source</span>,<br>    cnt <br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> * <br>    <span class="hljs-keyword">FROM</span> (<br>        <span class="hljs-keyword">SELECT</span> <br>            *,<br>            <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> client_id) <span class="hljs-keyword">AS</span> cnt,<br>            <span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> user_id) <span class="hljs-keyword">AS</span> user_num<br>        <span class="hljs-keyword">FROM</span> order_info<br>        <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>        <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>        <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br>        ) t0 <br>    <span class="hljs-keyword">WHERE</span> user_num &gt;= <span class="hljs-number">2</span><br>) t1<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> (<br>    <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">client</span><br>) t2<br><span class="hljs-keyword">ON</span> t1.client_id = t2.id<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> t1.client_id<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">IF</span>(<span class="hljs-keyword">name</span> <span class="hljs-keyword">IS</span> <span class="hljs-literal">NULL</span>,<span class="hljs-string">'GroupBuy'</span>,<span class="hljs-keyword">name</span>)<br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧的写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">IFNULL</span>(client.name,<span class="hljs-string">'GroupBuy'</span>) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">source</span>,<span class="hljs-keyword">COUNT</span>(*) <span class="hljs-keyword">AS</span> cnt<br><span class="hljs-keyword">FROM</span> (<br><br>    <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> order_info<br>    <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-keyword">IN</span> (<br>        <span class="hljs-keyword">SELECT</span> user_id <span class="hljs-keyword">FROM</span> order_info<br>        <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>        <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>        <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>        <span class="hljs-keyword">HAVING</span> <span class="hljs-keyword">COUNT</span>(*) &gt;= <span class="hljs-number">2</span><br>    )<br>    <span class="hljs-keyword">AND</span> <span class="hljs-keyword">status</span> = <span class="hljs-string">'completed'</span><br>    <span class="hljs-keyword">AND</span> product_name <span class="hljs-keyword">IN</span> (<span class="hljs-string">'C++'</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'Python'</span>)<br>    <span class="hljs-keyword">AND</span> <span class="hljs-built_in">date</span> &gt; <span class="hljs-string">'2025-10-15'</span><br>    <br>) a<br><span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">client</span> <span class="hljs-keyword">ON</span> a.client_id = client.id<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> client.name<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">source</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-72">84</h4>
<ul>
<li>新写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">num</span>) <span class="hljs-keyword">AS</span> cnt <span class="hljs-keyword">FROM</span> resume_info<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">SUBSTR</span>(<span class="hljs-built_in">date</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>) = <span class="hljs-string">'2025'</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cnt <span class="hljs-keyword">DESC</span><br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">num</span>) <span class="hljs-keyword">AS</span> cnt <span class="hljs-keyword">FROM</span> resume_info<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(<span class="hljs-built_in">date</span>) = <span class="hljs-string">'2025'</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cnt <span class="hljs-keyword">DESC</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-73">85</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">DATE_FORMAT</span>(<span class="hljs-built_in">date</span>,<span class="hljs-string">'%Y-%m'</span>) <span class="hljs-keyword">AS</span> mon,<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">num</span>) <span class="hljs-keyword">AS</span> cnt<br><span class="hljs-keyword">FROM</span> resume_info<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">SUBSTR</span>(<span class="hljs-built_in">date</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>) = <span class="hljs-string">'2025'</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job,mon<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> mon <span class="hljs-keyword">DESC</span>,cnt <span class="hljs-keyword">DESC</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-74">86</h4>
<ul>
<li>旧写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t1.job,t1.mon,t1.cnt,t2.mon,t2.cnt<br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">DATE_FORMAT</span>(<span class="hljs-built_in">date</span>,<span class="hljs-string">'%Y-%m'</span>) <span class="hljs-keyword">AS</span> mon,<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">num</span>) <span class="hljs-keyword">AS</span> cnt<br>    <span class="hljs-keyword">FROM</span> resume_info<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">DATE_FORMAT</span>(<span class="hljs-built_in">date</span>,<span class="hljs-string">'%Y'</span>) = <span class="hljs-number">2025</span><br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job,mon<br>    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> mon <span class="hljs-keyword">DESC</span>,cnt <span class="hljs-keyword">DESC</span><br>) t1,<br>(<br>    <span class="hljs-keyword">SELECT</span> job,<span class="hljs-keyword">DATE_FORMAT</span>(<span class="hljs-built_in">date</span>,<span class="hljs-string">'%Y-%m'</span>) <span class="hljs-keyword">AS</span> mon,<span class="hljs-keyword">SUM</span>(<span class="hljs-keyword">num</span>) <span class="hljs-keyword">AS</span> cnt<br>    <span class="hljs-keyword">FROM</span> resume_info<br>    <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">DATE_FORMAT</span>(<span class="hljs-built_in">date</span>,<span class="hljs-string">'%Y'</span>) = <span class="hljs-number">2026</span><br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> job,mon<br>    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> mon <span class="hljs-keyword">DESC</span>,cnt <span class="hljs-keyword">DESC</span><br>) t2<br><span class="hljs-keyword">WHERE</span> t1.job =t2.job<br><span class="hljs-keyword">AND</span> <span class="hljs-keyword">SUBSTR</span>(t1.mon,<span class="hljs-number">-2</span>) = <span class="hljs-keyword">SUBSTR</span>(t2.mon,<span class="hljs-number">-2</span>)<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> t1.mon <span class="hljs-keyword">DESC</span>,job <span class="hljs-keyword">DESC</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-75">87</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> grade,<span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade) <span class="hljs-keyword">FROM</span> class_grade<br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-76">86</h4>
<ul>
<li>新写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> grade <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span>  <br>        grade,<br>        <span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade) <span class="hljs-keyword">AS</span> rn1,<br>        <span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rn2,<br>        (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">FROM</span> class_grade) <span class="hljs-keyword">AS</span> cnt<br>    <span class="hljs-keyword">FROM</span> class_grade<br>) t<br><span class="hljs-keyword">WHERE</span> t.rn1 &gt;= cnt/<span class="hljs-number">2</span><br><span class="hljs-keyword">AND</span> t.rn2 &gt;= cnt/<span class="hljs-number">2</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade<br></code></pre></div></td></tr></tbody></table></figure>
<ul>
<li>旧写法</li>
</ul>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> grade <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span>  grade,<span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade) <span class="hljs-keyword">AS</span> rs1,<span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rs2<br>    <span class="hljs-keyword">FROM</span> class_grade<br>    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>  grade<br>) t<br><span class="hljs-keyword">WHERE</span> t.rs1 &gt;= (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">FROM</span> class_grade)/<span class="hljs-number">2</span><br><span class="hljs-keyword">AND</span> t.rs2 &gt;= (<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">SUM</span>(<span class="hljs-built_in">number</span>) <span class="hljs-keyword">FROM</span> class_grade)/<span class="hljs-number">2</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-77">89</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>,grade_sum <span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">name</span>,<span class="hljs-keyword">SUM</span>(grade_num) <span class="hljs-keyword">AS</span> grade_sum <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span><br>    <span class="hljs-keyword">JOIN</span> grade_info<br>    <span class="hljs-keyword">ON</span> user.id = grade_info.user_id<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">name</span><br>) t<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade_sum <span class="hljs-keyword">DESC</span><br><span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><br></code></pre></div></td></tr></tbody></table></figure>
<h4 id="section-78">90</h4>
<figure class="highlight sql"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> user.id,user.name,grade_sum<br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> *,<span class="hljs-keyword">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> grade_sum <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rs <br>    <span class="hljs-keyword">FROM</span> (<br>        <span class="hljs-keyword">SELECT</span> user_id,<span class="hljs-keyword">SUM</span>(grade_num) <span class="hljs-keyword">AS</span> grade_sum <span class="hljs-keyword">FROM</span> grade_info<br>        <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id<br>    ) t1<br>) t2<br><span class="hljs-keyword">JOIN</span> <span class="hljs-keyword">user</span><br><span class="hljs-keyword">ON</span> user.id = b.user_id<br><span class="hljs-keyword">WHERE</span> rs = <span class="hljs-number">1</span><br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> user.id<br></code></pre></div></td></tr></tbody></table></figure>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/">数据仓库</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/SQL/">SQL</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/11/10/clickhouse_yuan_li_jie_xi_yu_ying_yong_shi_jian_yue_du_bi_ji/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">《ClickHouse原理解析与应用实践》阅读笔记</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/04/hive_tong_bu_ye_wu_ku_mysql_biao_fang_an/">
                        <span class="hidden-mobile">Hive同步业务库MySQL表方案</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     
  </div>
  

  

  



  
    <script src='https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js'></script>
    <script>
      if (window.mermaid) {
        mermaid.initialize({theme: 'forest'});
      }
    </script>
  


</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const mathjax = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  











<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
